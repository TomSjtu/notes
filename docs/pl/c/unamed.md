# C语言杂项


## extern关键字

`extern`关键字用来告诉编译器，这里声明的变量或者函数名在别处定义，在此处声明。

!!! tip

    定义：创建变量并分配内存空间
    声明：说明变量的性质，并不分配内存空间

```C
extern int i;   //此为声明
int i;         //此为定义
```

如果在.h头文件中声明一个全局变量，即为{==外部变量==}。外部变量保存在静态存储区，其生命周期存在于整个程序运行期，因此，外部变量不能出现重名，否则就会报{==重定义==}的错误。如果是内部变量，比如在函数内定义的变量，就不会出现这种问题。

### 多文件编程

在一个大型项目工程中，有的时候我们需要提前使用已经定义好的全局变量。

假设在"test.h"中：`int a = 10;`。这里`a`就是一个全局变量的{==定义==}，如果"test.h"头文件被多次引用，`a`就会被重复定义，这是不被允许的。

在《高质量C/C++编程指南》一书中写到：头文件中只存放“声明”，而不存放“定义”。

!!! question

    如果我们需要在"main.c"中使用到该全局变量，应该怎么修改呢？

答案就是使用`extern`关键字。

在"test.h"中：`extern int a`——这是一个声明。同时在"test.c"中：`int a = 10;`——这是一个定义。

这样在"main.c"中就可以直接引用变量a了。

### 头文件重复包含

`#include`命令在预处理阶段会直接被展开，预处理器将展开后的代码直接复制到.c文件中。如果被包含的头文件中还包含了其他的头文件，预处理器就会递归地包含这些头文件直到不再包含任何头文件。

递归包含会引入一个问题，就是重复地引入一个相同的头文件，这会导致变量重定义的错误。比如"test1.h"中定义了变量a，"test2.h"和"test3.h"都包含了"test1.h"，那么编译的时候就会报错。

为了解决这个问题，C语言提供了`#ifndef`、`#define`和`#endif`三个预处理命令。这种宏保护方案使得程序员可以随意地引入当前模块需要的所有头文件，而不用操心这些头文件中是否包含了其他的头文件。

MSVC编译器提供了`#pragma once`来达到同样的效果，该宏并不是跨平台的，所以如果想要跨平台还是得使用条件编译指令。