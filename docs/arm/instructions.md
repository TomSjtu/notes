# A64指令集

ARMv8增加了新的64位指令集，它可以处理64位宽的寄存器和数据并且使用64位的指针来访问内存，但是其指令集的指令宽度是32位。ARMv8兼容A32指令集，但A64指令集和A32指令集是不兼容的。

ARMv8支持两种执行状态——AArch64和AArch32。AArch64状态用于执行64位指令，而AArch32状态用于执行32位指令。

## 加载与存储指令

### LDR和STR指令

```assembly
ldr 目标寄存器, <存储器地址>    //把存储器地址的数据加载到目标寄存器

str 源寄存器, <存储器地址>      //把源寄存器中的数据存储到存储器地址
```

```assembly
ldr     x1,=0xE0000000  ;x1=0xE0000000
ldr     x1,0xE0000000   ;将内存中地址为0xE0000000的内容载入到x1
ldr     x1,[x0]         ;将x0中的数所指定的地址的内容传输到x1
```

### 入栈与出栈

函数传递的参数如果少于8个，则使用X0-X7寄存器传递，如果多于8个，则使用栈传递。SP指针指向栈顶，从栈底到栈顶的这段空间，称为栈帧。

A32指令集提供了POUSH与POP指令来实现入栈与出栈，但是A64指令集已经移除，而转而使用加载与存储指令。


### MOV指令

MOV指令只能用于数据在寄存器之间的搬移，以及往寄存器里写立即数，但是有限制。


## 算术与移位指令

### 条件操作码

PSTATE中有四个条件标志位，分别是N、Z、C、V，代表上一次运算的结果。

| 条件标志位 | 含义 |
| ---------- | ---- |
| N           | 负数     |
| Z           | 零       |
| C           | 进位     |
| V           | 溢出     |