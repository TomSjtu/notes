
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="一只Tom的笔记本">
      
      
        <meta name="author" content="Tom">
      
      
        <link rel="canonical" href="https://tomsjtu.github.io/notes/rtos/freertos/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="CMSIS/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.14">
    
    
      
        <title>简明入门 - 一只Tom的笔记本</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fad675c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="一只Tom的笔记本" class="md-header__button md-logo" aria-label="一只Tom的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            一只Tom的笔记本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              简明入门
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/TomSjtu/notes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../linux/" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  RTOS

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../arm/" class="md-tabs__link">
          
  
    
  
  Arm

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../pl/" class="md-tabs__link">
          
  
    
  
  编程语言

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../cloud/" class="md-tabs__link">
          
  
    
  
  云原生

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tools/" class="md-tabs__link">
          
  
    
  
  Tools

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../others/" class="md-tabs__link">
          
  
    
  
  其他

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="一只Tom的笔记本" class="md-nav__button md-logo" aria-label="一只Tom的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    一只Tom的笔记本
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/TomSjtu/notes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../linux/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../linux/kernel/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    内核剖析
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            内核剖析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/kernel/sched/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    进程管理与调度
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/kernel/vma/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    进程地址空间
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/kernel/interrupt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    中断和中断处理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/kernel/synch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内核同步
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/kernel/others/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    其他
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../linux/drivers/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    设备驱动程序
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            设备驱动程序
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/drivers/dts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    设备树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/drivers/chardev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字符设备驱动程序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/drivers/framework/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    驱动框架
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    RTOS
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            RTOS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="./" class="md-nav__link md-nav__link--active">
              
  
  <span class="md-ellipsis">
    freertos
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            freertos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="CMSIS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CMSIS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../rt-thread/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    rt-thread
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            rt-thread
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../arm/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Arm
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Arm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../arm/barrier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内存屏障
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../pl/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    编程语言
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            编程语言
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cloud/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    云原生
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            云原生
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tools/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../others/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    其他
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            其他
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../others/ld/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    从代码到可执行文件
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      内存管理
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      任务管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="任务管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      创建任务
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tick" class="md-nav__link">
    <span class="md-ellipsis">
      Tick
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      任务状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      调度算法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      空闲任务和钩子函数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      任务同步与通信
    </span>
  </a>
  
    <nav class="md-nav" aria-label="任务同步与通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      消息队列
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      信号量
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      互斥量
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      事件组
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      任务通知
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      软件定时器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      中断管理
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="_1">简明入门<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>大多数的操作系统都能同时执行多个程序，这被称为多任务处理。实际上，每个处理器核心在给定时间片内只能运行单个任务。CPU通过快速切换时间片造成多个任务同时执行的假象。
实时操作系统(RTOS)中的任务调度器旨在提供可预测的执行模式。这种方式对嵌入式系统意义重大，因为嵌入式系统往往有实时性的要求，比如我要求在3秒内发出警报声。</p>
<p>使用STM32CubeMX创建的FreeRTOS工程中，源码主要涉及两个目录：</p>
<ul>
<li>Core<ul>
<li>Inc目录下的FreeRTOSConfig.h是配置文件</li>
<li>Src目录下的freertos.c是STM32CubeMX创建的默认任务</li>
</ul>
</li>
<li>Middlewares/Thirt_Party/FreeRTOS/Source<ul>
<li>根目录下是核心文件，这些文件是通用的</li>
<li>portable目录下是移植时需要的文件：port.c和portmacro.h<ul>
<li>目录名为：[compiler]/[architecture]</li>
<li>比如：RVDS/ARM-CM3，这表示cortexM3架构在RVDS工具上的移植文件</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>FreeRTOS/Srouce/</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>tasks.c</td>
<td>必须，任务操作</td>
</tr>
<tr>
<td>list.c</td>
<td>必须， 列表</td>
</tr>
<tr>
<td>queue.c</td>
<td>基本必须，提供队列操作、信号量</td>
</tr>
<tr>
<td>timer.c</td>
<td>可选，提供定时器</td>
</tr>
<tr>
<td>event_groups.c</td>
<td>可选，提供event group功能</td>
</tr>
<tr>
<td>croutine.c</td>
<td>可选，已过时</td>
</tr>
</tbody>
</table>
<p>头文件目录需要包含：</p>
<ul>
<li>
<p>FreeRTOS自身头文件：Middlewares/Third_Party/FreeRTOS/Source/include</p>
</li>
<li>
<p>配置文件：Core/Inc/FreeRTOSConfig.h</p>
</li>
</ul>
<p>数据类型：</p>
<p>在portmacro.h头文件里，定义了两个数据类型：</p>
<ul>
<li>TickType_t：<ul>
<li>FreeRTOS配置了一个周期性的时钟中断：Tick Interrupt</li>
<li>每发生一次中断，中断次数累加，这被称为tick count</li>
<li>tick count这个变量的类型就是TickType_t</li>
<li>TickType_t可以是16位的，也可以是32位的</li>
<li>FreeRTOSConfig.h中定义configUSE_16_BIT_TICKS时，TickType_t就是uint16_t</li>
<li>否则TickType_t就是uint32_t</li>
<li>对于32位架构，建议把TickType_t配置为uint32_t</li>
</ul>
</li>
<li>BaseType_t：<ul>
<li>这是该架构最高效的数据类型</li>
<li>32位架构中，它就是uint32_t</li>
<li>16位架构中，它就是uint16_t</li>
<li>8位架构中，它就是uint8_t</li>
<li>BaseType_t通常用作简单的返回值的类型，还有逻辑值，比如pdTRUE/pdFALSE</li>
</ul>
</li>
</ul>
<p>命名规范：</p>
<table>
<thead>
<tr>
<th>变量名前缀</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>ul</td>
<td>uint32_t</td>
</tr>
<tr>
<td>us</td>
<td>uint16_t</td>
</tr>
<tr>
<td>uc</td>
<td>uint8_t</td>
</tr>
<tr>
<td>x</td>
<td>非stdint类型，比如BaseType_t和TickType_t，或者size_t</td>
</tr>
<tr>
<td>ux</td>
<td>UBaseType_t</td>
</tr>
<tr>
<td>e</td>
<td>enum</td>
</tr>
<tr>
<td>p</td>
<td>指针</td>
</tr>
<tr>
<td>c</td>
<td>char</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>函数名前缀</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>prv</td>
<td>私有函数(file scope)</td>
</tr>
<tr>
<td>v</td>
<td>返回值void</td>
</tr>
<tr>
<td>task</td>
<td>定义在task.c</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>宏前缀</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>config</td>
<td>定义在FreeRTOSConfig.h</td>
</tr>
</tbody>
</table>
<h2 id="_2">内存管理<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>每次创建任务、队列、互斥锁、软件定时器、信号量或事件组时，内核都需要RAM，RAM可以由RTOS堆动态分配，也可以由编写者手动提供。</p>
<p>尽管C库提供了<code>malloc()</code>和<code>free()</code>函数，但是：
1. 它们并不总是适用于嵌入式系统
2. 它们耗费时间比较长
3. 它们不是线程安全的
4. 运行结果不确定</p>
<p>因此freertos实现了自己的内存分配接口函数。</p>
<p>freertos中有五种堆内存，文件定义在Middlewares/Third_Party/FreeRTOS/Source/portable/MemMang下。其中最常用的是heap_4.c，它可以将相邻的空间内存块合并，解决了内存碎片问题。而heap_5.c允许多个不连续的内存区域。需要用到以下结构体进行不同内存块的初始化：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">HeapRegion</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="p">{</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">pucStartAddress</span><span class="p">;</span><span class="w">   </span><span class="c1">//起始地址</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">xSizeInBytes</span><span class="p">;</span><span class="w">       </span><span class="c1">//大小</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">}</span><span class="n">HeapRegion_t</span><span class="p">;</span>
</code></pre></div>
<p>当指定多块内存时，需要用到HeapRegion_t类型的数据，每个数组元素都是一个HeapRegion_t元素。这个数组中，低地址在前，高地址在后。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">HeapRegion_t</span><span class="w"> </span><span class="n">xHeapRegions</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="p">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="p">{(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="mh">0x80000000UL</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10000</span><span class="p">},</span><span class="w"> </span><span class="c1">//起始地址和大小</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="p">{(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="mh">0x90000000UL</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10000</span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="p">{</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span><span class="w">  </span><span class="c1">//表示数组结束</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="p">};</span>
</code></pre></div>
<p>定义了内存块数组还需要对其进行初始化：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">vPortDefineHeapRegions</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">HeapRegion_t</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">pxHeapRegions</span><span class="p">);</span>
</code></pre></div>
<p>Heap的分配和释放：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">pvPortMalloc</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">xWantedSize</span><span class="p">);</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">vPortFree</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">pv</span><span class="p">);</span>
</code></pre></div>
<p>获取当前空闲内存空间：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kt">size_t</span><span class="w"> </span><span class="nf">xPortGetFreeHeapSize</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</code></pre></div>
<p>获取程序运行时空闲内存的最小值：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kt">size_t</span><span class="w"> </span><span class="nf">xPortGetMinimumEverFreeHeapSize</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</code></pre></div>
<h2 id="_3">任务管理<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>一个任务最基本的元素有：</p>
<ul>
<li>任务状态：比如阻塞，就绪，挂起等</li>
<li>优先级：每个任务都分配了从0到configMAX_PRIORITIES-1的优先级</li>
<li>栈：用来保存任务的局部数据</li>
<li>事件：表示任务做了什么事情</li>
</ul>
<p>对于单核处理器来说，任何时刻只能有一个任务得到运行，当调度器决定切换任务时，需要将上一个任务的上下文（寄存器，栈）保存。需要注意的是，如果一个任务出现了死循环操作，那么比这个任务优先级低的任务都将无法执行。所以在设计的时候，应该保证任务在不活跃状态时进入阻塞状态以让出CPU使用权，保证其他低优先级的任务可以执行。</p>
<h3 id="_4">创建任务<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>在FreeRTOS中，任务函数的定义如下：</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">vATaskFunction</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">pvParameters</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="k">for</span><span class="p">(;;)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">        </span><span class="c1">//RTOS推荐采用事件驱动型任务</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">WaitForEvent</span><span class="p">(</span><span class="n">EventObject</span><span class="p">,</span><span class="w"> </span><span class="n">Timeout</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pdPASS</span><span class="p">)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">            </span><span class="c1">//处理事件</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span><span class="n">vTaskDelete</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span><span class="w">  </span><span class="c1">//执行完毕删除自己</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="p">}</span>
</code></pre></div>
动态创建任务使用的函数如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">BaseType_t</span><span class="w"> </span><span class="nf">xTaskCreate</span><span class="p">(</span><span class="n">TaskFunction_t</span><span class="w"> </span><span class="n">pxTaskCode</span><span class="p">,</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">pcName</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">configSTACK_DEPTH_TYPE</span><span class="w"> </span><span class="n">usStackDepth</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">                        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">pvParameters</span><span class="p">,</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">                        </span><span class="n">UBaseType_t</span><span class="w"> </span><span class="n">uxPriority</span><span class="p">,</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">                        </span><span class="n">TaskHandle_t</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">pxCreatedTask</span><span class="p">);</span>
</code></pre></div>
<p>参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>pvTaskCode</td>
<td>任务函数</td>
</tr>
<tr>
<td>pcName</td>
<td>任务名称</td>
</tr>
<tr>
<td>usStackDepth</td>
<td>任务栈大小，单位word</td>
</tr>
<tr>
<td>pvParameters</td>
<td>传递给任务函数的参数</td>
</tr>
<tr>
<td>uxPriority</td>
<td>任务优先级</td>
</tr>
<tr>
<td>pxCreatedTask</td>
<td>任务句柄，用来操作任务函数</td>
</tr>
<tr>
<td>返回值</td>
<td>成功返回pdPass，失败通常是因为内存不足</td>
</tr>
</tbody>
</table>
<p>静态创建任务使用的函数如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">TaskHandle_t</span><span class="w"> </span><span class="nf">xTaskCreateStatic</span><span class="p">(</span><span class="n">TaskFunction_t</span><span class="w"> </span><span class="n">pxTaskCode</span><span class="p">,</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">pcName</span><span class="p">,</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ulStackDepth</span><span class="p">,</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">                                </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">pvParameters</span><span class="p">,</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">                                </span><span class="n">UBaseType_t</span><span class="w"> </span><span class="n">uxPriority</span><span class="p">,</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">                                </span><span class="n">StackType_t</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">puxStackBuffer</span><span class="p">,</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">                                </span><span class="n">StaticTask_t</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">pxTaskBuffer</span><span class="p">);</span>
</code></pre></div>
<p>相对于动态分配，有两个参数不同：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>puxStackBuffer</td>
<td>栈数组，索引必须不小于ulStackDepth</td>
</tr>
<tr>
<td>pxTaskBuffer</td>
<td>指向StaticTask_t的指针，用来保存任务结构体</td>
</tr>
</tbody>
</table>
<p>每个任务都需要RAM来保存任务状态，并由任务用作其堆栈。如果使用动态创建，则会在程序运行时从FreeRTOS堆中自动分配RAM。如果是静态创建，RAM由编写者手动提供，但在编译时就已确定。</p>
<h3 id="tick">Tick<a class="headerlink" href="#tick" title="Permanent link">&para;</a></h3>
<p>任务进入睡眠后需要指定唤醒的时间，FreeRTOS通过Tick变量测量时间。定时器中断以严格的时间精度增加Tick count。每次Tick增加时，内核必须检查现在是否需要解除阻塞或者唤醒任务，高优先级的任务先被唤醒。任务通过调用<code>vTaskDelay()</code>函数来主动等待一定的时间。宏<code>pdMS_TO_TICKS()</code>将毫秒转换为Tick count。</p>
<p>需要注意的是，由于内核本身的任务切换需要时间，当指定N个Tick的延迟后，实际延迟时间将在(N-1)~(N)个Tick之间。</p>
<h3 id="_5">任务状态<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>任务可以有以下状态：</p>
<ul>
<li>
<p>运行：最高优先级的任务被执行</p>
</li>
<li>
<p>就绪：能够执行，等待调度器调度</p>
</li>
<li>
<p>阻塞：正在等待时间或者外部事件</p>
</li>
<li>
<p>挂起：放弃CPU使用权，不参与调度。</p>
</li>
</ul>
<p><img alt="tskstate" src="../../images/freertos/tskstate.gif" /></p>
<h3 id="_6">调度算法<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>两个核心概念：<strong>抢占</strong>和<strong>轮转</strong>。通过配置configUSE_PREEMPTION使能抢占，即高优先级的任务可以抢占低优先级的任务。通过配置configUSE_TIME_SLICING使能轮转，即相同优先级的任务轮流执行。</p>
<h3 id="_7">空闲任务和钩子函数<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>在没有其他任务运行的时候，执行空闲任务。<code>vTaskStartScheduler()</code>函数内部会创建空闲任务，它的优先级为0，永远低于用户任务，且要么处于就绪态，要么处于运行态。</p>
<p>我们可以在空闲任务内添加一个钩子函数，这样空闲任务每执行一次，都会调用一次钩子函数。钩子函数的作用是：</p>
<ul>
<li>执行一些后台任务</li>
<li>测量系统空闲时间</li>
<li>使系统进入省电模式</li>
</ul>
<p>要注意的是，钩子函数不能调用任何使其导致阻塞的函数。空闲钩子函数的定义如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">vApplicationIdleHook</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</code></pre></div>
<h2 id="_8">任务同步与通信<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>这里面的内容以理解原理为主，没有必要去记函数接口，用到什么就查什么。</p>
<h3 id="_9">消息队列<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>消息队列简称为队列，是一种先进先出的数据结构，支持任务或者中断的读写。当队列中的消息为空时，读取消息的任务将被阻塞；当队列已满，发送消息的任务将被阻塞。可以将一条或者多条消息放入队列中，多个任务也可以从同一个消息队列读写消息。如果是紧急消息，可以发送至队列头从而提前被接收。</p>
<p>为了实现先进先出的机制，队列使用了阻塞的机制。当任务A对某个队列进行读操作时，如果队列此时为空，那么它可以选择：</p>
<ol>
<li>直接放弃读操作，去干别的事情。</li>
<li>进入阻塞状态，等待一段时间。如果在等待期间消息来了，就变为就绪状态；如果等待时间过了消息都没来，那么就返回一个未收到消息的错误码，然后执行其他程序。</li>
<li>死等直到消息到来为止。</li>
</ol>
<p>写操作的阻塞机制类似。</p>
<p>注意：由于中断函数也可以对队列进行读写操作，但是中断函数不允许阻塞，因此在中断处理流程中必须使用特殊的读写函数接口。</p>
<h3 id="_10">信号量<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>信号量分为二值信号量和计数信号量，其原理和Linux内核相似，这里不再赘述。</p>
<h3 id="_11">互斥量<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>互斥量是特殊的二值信号量，有着递归访问和防止优先级反转的特性，主要用于临界资源的保护。互斥量具有特殊的优先级继承的机制，要理解这个机制，我们首先要解释下什么是优先级反转。</p>
<p>在一个简化过的场景中，有三个任务H、M、L，它们的优先级依次为H&gt;M&gt;L。H与L共享某个资源，M不共享。在正常情况下，最高优先级的H应该能够优先执行，并且有权限打断M或者L的执行状态从而抢占CPU的控制权。然而存在一种情况,会导致H一直被阻塞，等待M和L的完成运行：</p>
<p>在某一时刻，L已经获取了共享资源的使用权，正在执行自己的任务。如果此时H被唤醒，由于H的优先级大于L，它尝试获取CPU的控制权。但是由于共享资源被L占用，H不得不等待L释放资源而进入阻塞状态。有趣的是，如果M被唤醒，由于M与L并不共享资源且优先级大于L，它将立刻中断L的执行，获取CPU的控制权。只有当M执行完毕时，才会将CPU控制权归还给L，使其可以继续执行剩余的代码。一旦L执行完毕后释放了共享资源，H任务才能从阻塞状态中被唤醒。我们发现，最高优先级的任务H反而需要等待两个低优先级的任务先执行完毕，其阻塞时间等于M和L的执行时间之和。这种现象被称为“优先级反转”，在系统中可能导致严重后果，甚至崩溃。例如，如果一辆汽车的刹车系统是最高优先级的任务，但需要等待其他任务执行完毕，这将导致灾难性的后果。因此为了确保系统的稳定运行，必须解决优先级反转问题。</p>
<p><img alt="Alt text" src="../../images/freertos/prio_reverse.png" /></p>
<p>但是假如我们引进了优先级继承机制。同样是L获取共享资源，H进入阻塞状态。系统临时将L的优先级提升到H，那么M就无法打断L的执行。所以L执行完它的任务就会立刻释放资源，然后由H来抢占CPU的使用权。其阻塞时间仅仅是L的执行时间，这将大大降低优先级反转的危害。</p>
<h3 id="_12">事件组<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>事件组主要用来实现多任务间的同步，只能用来事件的通信，不能用来发送数据。可以是一对多，也可以是多对一。</p>
<p>事件组用一个EventBits_t类型的变量来表示，其中高8位留给内核，用其他的位来表示事件。每一位都代表一个事件，含义由编写者决定，比如用bit0表示灯泡亮灭，bit1表示按键是否按下。这些位，值为1表示事件发生，值为0表示事件未发生。任务通过“逻辑与”、“逻辑或”与一个或者多个事件建立关联。逻辑与表示任务感兴趣的多个事件同时发生才被唤醒，逻辑或表示任一事件发生即可被唤醒。</p>
<p>事件组的操作流程如下：</p>
<ul>
<li>创建一个事件组</li>
<li>任务A、B控制事件中的某些位</li>
<li>任务C、D等待事件中的位，并且决定发生事件后的操作</li>
</ul>
<p>这里对两个比较重要的函数说明一下：</p>
<p>等待事件函数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">EventBits_t</span><span class="w"> </span><span class="nf">xEventGroupWaitBits</span><span class="p">(</span><span class="n">EventGroupsHandle_t</span><span class="w"> </span><span class="n">xEventGroup</span><span class="p">,</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="n">EvetnBits_t</span><span class="w"> </span><span class="n">uxBitsToWaitFor</span><span class="p">,</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="n">BaseType_t</span><span class="w"> </span><span class="n">xClearOnExit</span><span class="p">,</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="n">BaseType_t</span><span class="w"> </span><span class="n">xWaitForAllBits</span><span class="p">,</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">                                </span><span class="n">TickType_t</span><span class="w"> </span><span class="n">xTickToWait</span><span class="p">);</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>xEventGroup</td>
<td>等待的事件组</td>
</tr>
<tr>
<td>uxBitsToWaitFor</td>
<td>等待的位</td>
</tr>
<tr>
<td>xClearOnExit</td>
<td>pdTRUE:清除位</td>
</tr>
<tr>
<td>xWaitForAllBits</td>
<td>pdTRUE：等待的位全部为1；pdFALSE：某一位为1</td>
</tr>
<tr>
<td>xTicksToWait</td>
<td>阻塞时间</td>
</tr>
</tbody>
</table>
<p>举例说明：</p>
<table>
<thead>
<tr>
<th>事件组的值</th>
<th>uxBitsToWaitFor</th>
<th>xWaitForAllBits</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>0100</td>
<td>0101</td>
<td>pdTrue</td>
<td>期望bit0,bit2都为1，不满足进入阻塞</td>
</tr>
<tr>
<td>0100</td>
<td>0110</td>
<td>pdFALSE</td>
<td>期望bit0, bit2某位为1，满足退出</td>
</tr>
</tbody>
</table>
<p>同步事件函数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">EventBits_t</span><span class="w"> </span><span class="nf">xEventGroupSync</span><span class="p">(</span><span class="n">EventGroupHandle_t</span><span class="w"> </span><span class="n">xEventGroup</span><span class="p">,</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">EventBits_t</span><span class="w"> </span><span class="n">uxBitsToSet</span><span class="p">,</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">EventBits_t</span><span class="w"> </span><span class="n">uxBitsToWaitFor</span><span class="p">,</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">                            </span><span class="n">TickType_t</span><span class="w"> </span><span class="n">xTicksToWait</span><span class="p">);</span>
</code></pre></div>
<p>该函数用来协同多个任务，当期望的事件一起发生后，才会成功返回。</p>
<h3 id="_13">任务通知<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>FreeRTOS从V8.2.0版本开始提供任务通知这个功能。在大多数情况下，任务通知可以替代信号量、事件组，也可以替代长度为1的队列。任务通知更加灵活，执行速度更快，并且更加节省RAM空间，缺点是任务通知只能由一个任务来接收通知消息。</p>
<p>FreeRTOS提供以下几种方式发送通知给任务：</p>
<ul>
<li>如果有通知未读，不覆盖通知值</li>
<li>直接覆盖通知值</li>
<li>设置通知值的一个或者多个位，类似事件组</li>
<li>递增通知值，类似计数信号量</li>
</ul>
<p>任务通知是任务控制块中定义的一个成员变量，因此任务在被创建的时候，任务通知就已经被初始化了。任务通知可以由任务发送，也可以由中断发送。只有在任务中才可以等待通知，而不允许在中断中等待通知。如果任务在等待通知的时候暂时无效，则任务会根据用户指定的阻塞时间内进入阻塞状态。只要有任务或者中断发送任务通知，任务就会从阻塞状态解除。</p>
<p>每个任务都有一个结构体:TCB（Task Control Block），里面有两个成员，一个用来表示通知状态，一个用来表示通知值。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">tskTaskControlBlock</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="p">{</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="p">......</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="cm">/* configTASK_NOTIFICATION_ARRAY_ENTRIES = 1 */</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ulNotifiedValue</span><span class="p">[</span><span class="w"> </span><span class="n">configTASK_NOTIFICATION_ARRAY_ENTRIES</span><span class="w"> </span><span class="p">];</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ucNotifyState</span><span class="p">[</span><span class="w"> </span><span class="n">configTASK_NOTIFICATION_ARRAY_ENTRIES</span><span class="w"> </span><span class="p">];</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="p">......</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="p">}</span><span class="w"> </span><span class="n">tskTCB</span><span class="p">;</span>
</code></pre></div>
<p>通知状态有3种取值：</p>
<ul>
<li>taskNOT_WAITING_NOTIFICATION：任务没有在等待通知</li>
<li>taskWAITING_NOTIFICATION：任务在等待通知</li>
<li>taskNOTIFICATION_RECEIVED：任务接收到了通知</li>
</ul>
<h2 id="_14">软件定时器<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>软件定时器就是“闹钟”，你可以设置闹钟：早上7点叫醒你；或者，每工作一小时就休息一会。软件定时器的功能类似，可以是在未来某个时间点触发某个函数，也可以是周期性地运行函数。</p>
<p>软件定时器是由操作系统提供的一类接口，它构建在硬件定时器基础之上，以系统节拍周期为单位。系统节拍就是系统时钟的频率，配置为configTICK_RATE_HZ，默认为1000。也就是说1s跳动1000次，那么系统街拍周期就是1ms。软件定时器的定时数值必须是这个节拍周期的整数倍。当然，系统节拍精度越高，软件定时器所能设定的时间间隔就越小，但是系统的开销也会变大。</p>
<p>FreeRTOS通过一个prvTimerTask的守护任务来管理软件定时器，它是在启动调度器时自动创建的。守护任务会定期检查用户编写的定时器，并调用其回调函数。用户自己编写的任务函数要调用定时器函数时，是通过“定时器命令队列”和守护任务交互的。守护任务的主要工作就是从命令队列中取出命令、处理，执行定时器的回调函数。能否及时处理定时器命令，取决于守护任务的优先级。其优先级默认为confiTIMER_TASK_PRIORITY，为了更好地响应，该优先级应设置为所有任务中最高的优先级。</p>
<p>定时器回调函数的原型如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">ATimerCallback</span><span class="p">(</span><span class="n">TimerHandler_t</span><span class="w"> </span><span class="n">xTimer</span><span class="p">);</span>
</code></pre></div>
<p>定时器的回调函数是在守护任务中被调用的，因此该函数不能进入阻塞状态，也不能调用任何会引起阻塞的函数。</p>
<p>定时器的复位：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">BaseType_t</span><span class="w"> </span><span class="nf">xTimerReset</span><span class="p">(</span><span class="n">TimerHandle_t</span><span class="w"> </span><span class="n">xTimer</span><span class="p">,</span><span class="w"> </span><span class="n">TickType_t</span><span class="w"> </span><span class="n">xTicksToWait</span><span class="p">);</span>
</code></pre></div>
<p>使用该函数可以让定时器的状态从冬眠态变为运行态，如果定时器已经运行，则相当于重新确定超时时间。</p>
<p>修改周期：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">BaseType_t</span><span class="w"> </span><span class="nf">xTimerChangePeriod</span><span class="p">(</span><span class="n">TimerHandle_t</span><span class="w"> </span><span class="n">xTimer</span><span class="p">,</span><span class="w"> </span><span class="n">TickType_t</span><span class="w"> </span><span class="n">xNewPeriod</span><span class="p">,</span><span class="w"> </span><span class="n">TickType_t</span><span class="w"> </span><span class="n">xTicksToWait</span><span class="p">);</span>
</code></pre></div>
<h2 id="_15">中断管理<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<p>中断属于异步异常，来源于外部硬件。当没有中断发生时，CPU执行自己的任务。当中断产生时，CPU当前任务被打断，转而去执行中断处理程序。外部设备产生一个中断信号并发送至中断控制器，由中断控制器将信号再转发给CPU，CPU响应中断源的请求。当中断产生时，系统需要保存上下文状态。</p>
<p>中断的环境有两种：</p>
<ul>
<li>任务上下文：无论中断的优先级是多大，都会打断当前任务的执行。</li>
<li>中断上下文：仅更高优先级的中断可以打断当前中断的执行，这必须要系统支持中断嵌套。</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.path", "toc.follow", "navigation.top", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.cd18aaf1.min.js"></script>
      
    
  </body>
</html>